<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Bat Cave Explorer - Enhanced Edition</title>
    <link rel="stylesheet" href="styles.css?v=3.1">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bat Cave Explorer">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <!-- Game UI Overlay -->
        <div class="ui-overlay">
            <!-- Main Menu -->
            <div id="mainMenu" class="screen">
                <h1 class="game-title">ü¶á Bat Cave Explorer</h1>
                <h2 class="game-subtitle">Enhanced Edition</h2>
                <div class="menu-buttons">
                    <button id="playBtn" class="btn btn-primary">–ò–≥—Ä–∞—Ç—å</button>
                    <button id="settingsBtn" class="btn btn-secondary">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button id="achievementsBtn" class="btn btn-secondary">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
                    <button id="helpBtn" class="btn btn-secondary">üìñ –°–ø—Ä–∞–≤–∫–∞</button>
                    <button id="fullscreenBtn" class="btn btn-secondary">üì∫ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
                </div>
                <div class="high-score">
                    –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="highScore">0</span>
                </div>
            </div>

            <!-- Game HUD -->
            <div id="gameHUD" class="screen hidden">
                <div class="score-display">
                    <span id="currentScore">0</span>
                </div>
                <div class="power-up-indicator">
                    <div id="powerUpIcon" class="power-up-icon hidden"></div>
                    <div id="powerUpTimer" class="power-up-timer hidden"></div>
                </div>
                <div class="controls-hint">
                    <span class="desktop-hint">–ù–∞–∂–º–∏—Ç–µ SPACE –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø–æ–ª—ë—Ç–∞</span>
                    <span class="mobile-hint">–ö–∞—Å–∞–π—Ç–µ—Å—å —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –ø–æ–ª—ë—Ç–∞</span>
                </div>
            </div>

            <!-- Game Over Screen -->
            <div id="gameOverScreen" class="screen hidden">
                <h2 class="game-over-title">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
                <div class="final-score">
                    –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="finalScore">0</span>
                </div>
                <div class="best-score">
                    –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="bestScore">0</span>
                </div>
                <div class="achievements-earned" id="achievementsEarned"></div>
                <div class="game-over-buttons">
                    <button id="restartBtn" class="btn btn-primary">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    <button id="menuBtn" class="btn btn-secondary">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
                </div>
            </div>

            <!-- God Mode Finale Screen -->
            <div id="godModeFinaleScreen" class="screen hidden">
                <h1 class="finale-title">üéÜ –ù–ï–í–û–ó–ú–û–ñ–ù–û! üéÜ</h1>
                <h2 class="finale-subtitle">You are monster!</h2>
                <h3 class="finale-message">You fuck this game!</h3>
                <p class="finale-score">–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: <span id="finaleScore">1000+</span></p>
                <p class="finale-note">üéÆ –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∫–æ—Ä–¥—ã</p>
                <div class="menu-buttons">
                    <button id="finaleMenuBtn" class="btn btn-primary">üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏</button>
                </div>
            </div>

            <!-- Settings Screen -->
            <div id="settingsScreen" class="screen hidden">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <div class="settings-group">
                    <label>
                        <input type="checkbox" id="soundToggle" checked>
                        –ó–≤—É–∫
                    </label>
                </div>
                <div class="settings-group">
                    <label>
                        <input type="checkbox" id="godModeToggle">
                        üéÆ –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (–±–µ—Å—Å–º–µ—Ä—Ç–∏–µ)
                    </label>
                </div>
                <div class="settings-group">
                    <label class="difficulty-label">
                        –°–ª–æ–∂–Ω–æ—Å—Ç—å:
                        <div class="select-wrapper">
                            <select id="difficultySelect" class="styled-select">
                                <option value="easy">–õ–µ–≥–∫–∞—è</option>
                                <option value="normal" selected>–û–±—ã—á–Ω–∞—è</option>
                                <option value="hard">–°–ª–æ–∂–Ω–∞—è</option>
                                <option value="extreme">–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è</option>
                            </select>
                        </div>
                    </label>
                </div>
                <div class="settings-group">
                    <label>
                        <input type="checkbox" id="powerUpsToggle" checked>
                        –ë–æ–Ω—É—Å—ã
                    </label>
                </div>
                <button id="backToMenuBtn" class="btn btn-secondary">–ù–∞–∑–∞–¥</button>
            </div>

            <!-- Achievements Screen -->
            <div id="achievementsScreen" class="screen hidden">
                <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
                <div id="achievementsList" class="achievements-list">
                    <!-- Achievements will be populated by JavaScript -->
                </div>
                <button id="achievementsBackBtn" class="btn btn-secondary">–ù–∞–∑–∞–¥</button>
            </div>

            <!-- Help Screen -->
            <div id="helpScreen" class="screen hidden">
                <h2>üìñ –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏–≥—Ä–µ</h2>
                <div class="help-content">
                    
                    <!-- Game Controls -->
                    <div class="help-section">
                        <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                        <div class="help-item">
                            <strong>SPACE / –ö–ª–∏–∫ / –¢–∞–ø</strong> - –ø–æ–ª—ë—Ç –ª–µ—Ç—É—á–µ–π –º—ã—à–∏
                        </div>
                        <div class="help-item">
                            <strong>ESC</strong> - –ø–∞—É–∑–∞ / –≤–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é
                        </div>
                    </div>

                    <!-- Power-ups Section -->
                    <div class="help-section">
                        <h3>‚≠ê –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (Power-ups)</h3>
                        
                        <div class="powerup-grid">
                            <div class="powerup-card shield">
                                <div class="powerup-icon">üõ°Ô∏è</div>
                                <div class="powerup-info">
                                    <h4>–ó–∞—â–∏—Ç–Ω—ã–π –±–∞—Ä—å–µ—Ä</h4>
                                    <p>–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å–∫–∞–ª–∞–º–∏. –õ–µ—Ç—É—á–∞—è –º—ã—à—å –æ–∫—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –≤ —Å–∏–Ω–∏–π —Ü–≤–µ—Ç.</p>
                                    <span class="powerup-duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 8 —Å–µ–∫</span>
                                </div>
                            </div>

                            <div class="powerup-card immortal">
                                <div class="powerup-icon">‚ú®</div>
                                <div class="powerup-info">
                                    <h4>–ë–µ—Å—Å–º–µ—Ä—Ç–∏–µ</h4>
                                    <p>–î–µ–ª–∞–µ—Ç –ª–µ—Ç—É—á—É—é –º—ã—à—å –Ω–µ—É—è–∑–≤–∏–º–æ–π –∫ –ª—é–±—ã–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è–º. –ú—ã—à—å –æ–∫—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –≤ –∑–æ–ª–æ—Ç–æ–π —Ü–≤–µ—Ç.</p>
                                    <span class="powerup-duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 5 —Å–µ–∫</span>
                                </div>
                            </div>

                            <div class="powerup-card doublepoints">
                                <div class="powerup-icon">üí∞</div>
                                <div class="powerup-info">
                                    <h4>–î–≤–æ–π–Ω—ã–µ –æ—á–∫–∏</h4>
                                    <p>–£–¥–≤–∞–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞–µ–º—ã—Ö –æ—á–∫–æ–≤. –û–∫—Ä–∞—à–∏–≤–∞–µ—Ç –º—ã—à—å –≤ –∑–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç.</p>
                                    <span class="powerup-duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 10 —Å–µ–∫</span>
                                </div>
                            </div>

                            <div class="powerup-card smallbat">
                                <div class="powerup-icon">üê£</div>
                                <div class="powerup-info">
                                    <h4>–ú–∏–Ω–∏-–º—ã—à—å</h4>
                                    <p>–£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ª–µ—Ç—É—á–µ–π –º—ã—à–∏, –æ–±–ª–µ–≥—á–∞—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç. –†–æ–∑–æ–≤—ã–π —Ü–≤–µ—Ç.</p>
                                    <span class="powerup-duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 8 —Å–µ–∫</span>
                                </div>
                            </div>

                            <div class="powerup-card extralife">
                                <div class="powerup-icon">‚ù§Ô∏è</div>
                                <div class="powerup-info">
                                    <h4>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∂–∏–∑–Ω—å</h4>
                                    <p>–î–∞—ë—Ç +5 –æ—á–∫–æ–≤ —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–±–æ—Ä–µ. –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç.</p>
                                    <span class="powerup-duration">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</span>
                                </div>
                            </div>

                            <div class="powerup-card magnet">
                                <div class="powerup-icon">üß≤</div>
                                <div class="powerup-info">
                                    <h4>–ú–∞–≥–Ω–∏—Ç–Ω–æ–µ –ø–æ–ª–µ</h4>
                                    <p>–ü—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫ –ª–µ—Ç—É—á–µ–π –º—ã—à–∏. –û—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç + –º–∞–≥–Ω–∏—Ç–Ω–æ–µ –ø–æ–ª–µ.</p>
                                    <span class="powerup-duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 12 —Å–µ–∫</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Obstacles Section -->
                    <div class="help-section">
                        <h3>üóø –¢–∏–ø—ã –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π</h3>
                        <div class="obstacles-grid">
                            <div class="obstacle-item">
                                <div class="obstacle-color normal"></div>
                                <span><strong>–û–±—ã—á–Ω—ã–µ —Å–∫–∞–ª—ã</strong> - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è</span>
                            </div>
                            <div class="obstacle-item">
                                <div class="obstacle-color narrow"></div>
                                <span><strong>–£–∑–∫–∏–µ –ø—Ä–æ—Ö–æ–¥—ã</strong> - –º–µ–Ω—å—à–∏–π –∑–∞–∑–æ—Ä (+2 –æ—á–∫–∞)</span>
                            </div>
                            <div class="obstacle-item">
                                <div class="obstacle-color wide"></div>
                                <span><strong>–®–∏—Ä–æ–∫–∏–µ –ø—Ä–æ—Ö–æ–¥—ã</strong> - –±–æ–ª—å—à–∏–π –∑–∞–∑–æ—Ä</span>
                            </div>
                            <div class="obstacle-item">
                                <div class="obstacle-color moving"></div>
                                <span><strong>–î–≤–∏–∂—É—â–∏–µ—Å—è —Å–∫–∞–ª—ã</strong> - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (+3 –æ—á–∫–∞)</span>
                            </div>
                            <div class="obstacle-item">
                                <div class="obstacle-color rotating"></div>
                                <span><strong>–í—Ä–∞—â–∞—é—â–∏–µ—Å—è —Å–∫–∞–ª—ã</strong> - –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è (+2 –æ—á–∫–∞)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tips Section -->
                    <div class="help-section">
                        <h3>üí° –°–æ–≤–µ—Ç—ã</h3>
                        <ul class="tips-list">
                            <li>–°–æ–±–∏—Ä–∞–π—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</li>
                            <li>–ó–∞—â–∏—Ç–Ω—ã–π –±–∞—Ä—å–µ—Ä –ø–æ–≥–ª–æ—â–∞–µ—Ç –æ–¥–Ω–æ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ</li>
                            <li>–†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Å–∫–∞–ª –¥–∞—é—Ç —Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤</li>
                            <li>–ú–∞–≥–Ω–∏—Ç –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏–∑–¥–∞–ª–µ–∫–∞</li>
                            <li>–ú–∏–Ω–∏-–º—ã—à—å –∏–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è —É–∑–∫–∏—Ö –ø—Ä–æ—Ö–æ–¥–æ–≤</li>
                        </ul>
                    </div>
                </div>
                
                <button id="helpBackBtn" class="btn btn-secondary">–ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <!-- Game Scripts - –°–Ω–∞—á–∞–ª–∞ –≤—Å–µ –∫–ª–∞—Å—Å—ã, –ø–æ—Ç–æ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
    <script src="js/sound.js?v=3.0"></script>
    <script src="js/bird.js?v=3.0"></script>
    <script src="js/pipes.js?v=3.0"></script>
    <script src="js/powerups.js?v=3.0"></script>
    <script src="js/achievements.js?v=3.0"></script>
    <script src="js/ui.js?v=3.2"></script>
    <script src="js/game.js?v=3.0"></script>
    <script src="js/main.js?v=3.0"></script>
    <script src="js/init.js?v=3.0"></script>

    <!-- Service Worker Registration -->
    <script>
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if ('caches' in window) {
            caches.keys().then(cacheNames => {
                cacheNames.forEach(cacheName => {
                    if (cacheName.includes('flappy-bird') || cacheName.includes('bat-cave')) {
                        console.log('Clearing old cache:', cacheName);
                        caches.delete(cacheName);
                    }
                });
            });
        }
        
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js?v=3.0')
                .then(registration => {
                    console.log('Service Worker registered');
                    
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Service Worker
                    if (registration.waiting) {
                        registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                    }
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Service Worker
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('New Service Worker available, reloading...');
                                window.location.reload();
                            }
                        });
                    });
                })
                .catch(error => {
                    console.log('Service Worker registration failed');
                });
        }
    </script>
</body>
</html>
